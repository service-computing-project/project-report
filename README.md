# é¡¹ç›®æŠ¥å‘Š

|   è¯¾ç¨‹åç§°    |  æœåŠ¡è®¡ç®—  |   ä»»è¯¾è€å¸ˆ    |    æ½˜èŒ‚æ—    |
| :-----------: | :--------: | :-----------: | :----------: |
|   **å¹´çº§**    | **2018çº§** |   **ä¸“ä¸š**    | **è½¯ä»¶å·¥ç¨‹** |
| **æˆå‘˜1å§“å** | **å­™æ„æ—** | **æˆå‘˜1å­¦å·** | **18342088** |
| **æˆå‘˜2å§“å** |  **æä½³**  | **æˆå‘˜2å­¦å·** | **18342048** |
| **æˆå‘˜3å§“å** | **å­™æµ©ç”·** | **æˆå‘˜3å­¦å·** | **18342087** |
| **æˆå‘˜4å§“å** | **å½­ç‚¯é›¯** | **æˆå‘˜4å­¦å·** | **18342083** |
| **æˆå‘˜5å§“å** | **èµµå˜‰ä»ª** | **æˆå‘˜5å­¦å·** | **1834136**  |
| **å¼€å§‹æ—¥æœŸ**  | 2020.12.8  | **å®Œæˆæ—¥æœŸ**  |  2020.12.22  |

## é¡¹ç›®åç§°

XBlog

## å¼€å‘ä¸è¿è¡Œç¯å¢ƒ

### å‰ç«¯

æ“ä½œç³»ç»Ÿï¼šWin10

å‰ç«¯æ¡†æ¶ï¼šAngular 10

ç»„ä»¶åº“ï¼šAnt Design


### åç«¯

æ“ä½œç³»ç»Ÿï¼šUbuntu 16.04/20.04

ç¼–ç¨‹ç¯å¢ƒï¼šgo version>=1.13.8

æ•°æ®åº“ï¼šMongoDB

## å°ç»„åˆ†å·¥

### å‰ç«¯

|  å§“å  |                             å·¥ä½œ                             |
| :----: | :----------------------------------------------------------: |
| å½­ç‚¯é›¯ | å®Œæˆå‰ç«¯é¡¹ç›®ç»“æ„è®¾è®¡ï¼›å®Œæˆç™»å½•/æ³¨å†Œæ¨¡å—ï¼›å¹¶è”åˆåç«¯å®ç°``token``è®¤è¯ï¼›å®Œæˆå¯¼èˆªæ æ¨¡å—ã€ä¸ªäººä¸»é¡µæ¨¡å—ï¼›å®Œæˆåå‘ä»£ç†é…ç½®ï¼Œè§£å†³è·¨åŸŸè¯·æ±‚ï¼›æ’°å†™å®éªŒæŠ¥å‘Šï¼›é¡¹ç›®logoè®¾è®¡ |
| èµµå˜‰ä»ª | å®ŒæˆContentã€Like èµ„æºå®¢æˆ·ç«¯ CRUD æœåŠ¡è¯·æ±‚é€»è¾‘ï¼›å¹¿åœºé¡µæ¨¡å—å®¢æˆ·ç«¯æœåŠ¡è¯·æ±‚ã€åŠŸèƒ½é€»è¾‘ã€å¸ƒå±€æ ·å¼ï¼›å†…å®¹è¯¦æƒ…é¡µæ¨¡å—å®¢æˆ·ç«¯æœåŠ¡è¯·æ±‚ã€åŠŸèƒ½é€»è¾‘ã€å¸ƒå±€æ ·å¼ï¼›å®¢æˆ·ç«¯åŠŸèƒ½æµ‹è¯•ï¼›æ’°å†™å®éªŒæŠ¥å‘Šï¼›å¼€å‘ç¯å¢ƒ Cookie å¤„ç† |



### åç«¯

|  å§“å  |                             å·¥ä½œ                             |
| :----: | :----------------------------------------------------------: |
| å­™æ„æ— | æ„å»ºæ•°æ®åº“ï¼Œå®Œæˆæ•°æ®åº“æœåŠ¡å™¨ã€åç«¯æœåŠ¡å™¨çš„éƒ¨ç½²ï¼Œå®Œæˆåç«¯åº•å±‚æ•°æ®åº“æ“ä½œæ¡†æ¶çš„æ„å»ºä¸å…·ä½“å®ç°ï¼ŒTravis CI éƒ¨ç½²ï¼Œæ’°å†™å®éªŒæŠ¥å‘Š |
|  æä½³  | æœåŠ¡ç«¯æ¶æ„ï¼ˆè·¯ç”±ï¼Œæ¨¡å‹ï¼‰ã€APIè®¾è®¡åŠæ–‡æ¡£æ’°å†™ã€Userã€Likeæ¨¡å—çš„æ§åˆ¶å™¨é€»è¾‘ã€API root è·å–ç®€å• API æœåŠ¡åˆ—è¡¨ |
| å­™æµ©ç”· | Contentã€Notificationæ¨¡å—æ§åˆ¶å™¨é€»è¾‘ï¼ŒåŸºäºjwtçš„Tokenå®ç°ä¸éªŒè¯ï¼Œæ’°å†™å®éªŒæŠ¥å‘Š |

## é¡¹ç›®éƒ¨ç½²è¯´æ˜

### å‰ç«¯

```bash
> git clone https://github.com/service-computing-project/project-front_end.git
> cd project-front_end
> npm install --registry="https://registry.npm.taobao.org"
> npm start
```
**æ³¨**ï¼šç”±äºnodejsä¾èµ–åŒ…è¿œç¨‹åº“å¯èƒ½æœ‰åŠ¨æ€æ›´æ–°ï¼Œè‹¥é‡è¿è¡Œç¼ºå°‘ä¾èµ–è€Œè¿è¡Œé”™è¯¯ï¼Œè¯·å°è¯•ï¼š
```bash
> npm install --registry="https://registry.npm.vmatrix.org.cn"
```
åå†æ¬¡è¿è¡Œ``npm start``ã€‚

### åç«¯

åç«¯éƒ¨ç½²ä½¿ç”¨go getï¼Œå…·ä½“å‘½ä»¤å¦‚ä¸‹ï¼š

```bash
> go get -insecure github.com/service-computing-project/project_app
> $GOPATH/bin/project_app
```

### æ•°æ®åº“éƒ¨ç½²

åç«¯ä¸­é›†æˆäº†ä¸€ä¸ªé˜¿é‡Œäº‘æœåŠ¡å™¨ä¸Šçš„æ•°æ®åº“ï¼Œå¦‚éœ€ä¿®æ”¹æ•°æ®åº“ï¼Œè¯·ä¿®æ”¹serviceä¸­`database.go`æ–‡ä»¶

## APIè¯´æ˜

ä»¥ä¸‹æ˜¯APIçš„æ¦‚è§ˆï¼š

- User
  - ç”¨æˆ·æ³¨å†Œï¼šç”¨äºç”¨æˆ·ä¿¡æ¯çš„æ³¨å†Œå’Œå†™å…¥æ•°æ®åº“
  - ç”¨æˆ·ç™»é™†ï¼šä½¿ç”¨ç”¨æˆ·åå’Œå¯†ç ç™»é™†å…¥ç³»ç»Ÿ
  - é€€å‡ºç™»é™†ï¼šé€€å‡ºå½“å‰ä½¿ç”¨çš„ç”¨æˆ·åå’Œå¯†ç 
  - æ›´æ–°ç”¨æˆ·åï¼šç”¨äºæ›´æ–°ç”¨æˆ·åï¼Œåªèƒ½åœ¨ç™»é™†åä½¿ç”¨
  - è·å–ç”¨æˆ·ä¿¡æ¯ï¼šé€šè¿‡ç”¨æˆ·IDè·å–ç”¨æˆ·ä¿¡æ¯ï¼Œå½“ä¸ºselfæ—¶è·å–è‡ªå·±ç”¨æˆ·ä¿¡æ¯
- Content
  - è·å–æŒ‡å®šå†…å®¹ï¼šé€šè¿‡æ–‡ç« IDè·å–æŒ‡å®šæ–‡ç« ä¿¡æ¯
  - åˆ é™¤æŒ‡å®šå†…å®¹ï¼šé€šè¿‡æ–‡ç« IDåˆ é™¤æŒ‡å®šå†…å®¹
  - è·å–å…¬å…±å†…å®¹ï¼šè·å–æ‰€æœ‰è®¾ç½®ä¸ºå…¬å…±ä¿¡æ¯çš„å†…å®¹å’Œä¿¡æ¯çš„å‘é€è€…
  - è·å–æŒ‡å®šç”¨æˆ·æ‰€æœ‰å†…å®¹ï¼šé€šè¿‡ç”¨æˆ·IDè·å–æŒ‡å®šç”¨æˆ·çš„å…¬å…±å†…å®¹ï¼Œselfæ—¶è·å–è‡ªå·±çš„å…¨éƒ¨å†…å®¹
  - å¢åŠ æ–‡æœ¬å†…å®¹ï¼šç”¨äºç”¨æˆ·å‘å¸ƒè‡ªå·±çš„æ–‡ç« 
- Like
  - è·å–ç‚¹èµåˆ—è¡¨ï¼šé€šè¿‡æ–‡ç« IDè·å–ç»™è¿™ç¯‡æ–‡ç« ç‚¹èµçš„ç”¨æˆ·å
  - å¯¹æŸä¸ªå†…å®¹ç‚¹èµï¼šé€šè¿‡æ–‡ç« IDå¯¹å…¶è¿›è¡Œç‚¹èµ
  - å–æ¶ˆç‚¹èµï¼šé€šè¿‡æ–‡ç« IDå–æ¶ˆå¯¹å…¶çš„ç‚¹èµ
- Notification
  - è·å–ç”¨æˆ·æ‰€æœ‰é€šçŸ¥ï¼šé€šè¿‡ç”¨æˆ·IDè·å–å…¶æ‰€æœ‰é€šçŸ¥
  - åˆ é™¤æŸæ¡é€šçŸ¥ï¼šé€šè¿‡é€šçŸ¥IDåˆ é™¤è¯¥é€šçŸ¥

æ›´è¯¦ç»†çš„è®¾è®¡æ–¹æ¡ˆè¯¦è§[APIæ–‡æ¡£](./API.md)

### APIå®ä¾‹ï¼šè·å–æŒ‡å®šç”¨æˆ·çš„æ‰€æœ‰å†…å®¹

```
GET /api/content/texts/{userID:string}
```

* userID string ç”¨æˆ·id(user_id="self"æ—¶ï¼Œè·å–è‡ªèº«ä¿¡æ¯)

#### Parameters

| å­—æ®µ     | ç±»å‹   | æè¿°   |
| -------- | ------ | ------ |
| page     | number | é¡µç    |
| per_page | number | é¡µå¤§å° |

#### Response

> Status: 200 OK
>
> Location: /api/content/texts/5c3774187a2bdd000111e10c?page=1&per_page=1

| å‚æ•°å      | ç±»å‹   | æè¿°          |
| ----------- | ------ | ------------- |
| State       | string | çŠ¶æ€          |
| Data        | array  | å†…å®¹ä¿¡æ¯æ•°ç»„  |

* å‚æ•°ä½¿ç”¨jsonå½¢å¼è§£æ

##### Example
```json
{
 "State": "success",
 "Data": [
  {
   "ID": "5b35115a7a2bdd4aac29eb74",
   "Detail": "testå†…å®¹",
   "OwnID": "5b3510fe7a2bdd4aac29eb73",
   "PublishDate": 1530204506000,
   "LikeNum": 2,
   "Public": true,
   "Tag": [
    "è¯´æ˜"
   ]
  }
 ]
}
```

## å‰ç«¯è¯¦ç»†è¯´æ˜

å‰ç«¯æ¡†æ¶ä½¿ç”¨``Angular 10``ï¼Œæ–‡ä»¶ç»“æ„è®¾è®¡å¦‚ä¸‹ï¼š

![](https://cdn.jsdelivr.net/gh/sherryjw/StaticResource@master/image/sc-hw9-002.png)

- _service: å­˜æ”¾å…±äº«æœåŠ¡ï¼Œç°ä»…åŒ…å«æ‹¦æˆªå™¨
- content: åšå®¢è¯¦æƒ…é¡µ
- error: é”™è¯¯é¡µ
- home: å¹¿åœºé¡µ
- login: ç™»å½•é¡µ
- nav-bar: å¯¼èˆªæ 
- new-content-editor-button: å…±äº«ç¼–è¾‘æŒ‰é’®
- register: æ³¨å†Œé¡µ
- user: ç”¨æˆ·ä¸ªäººä¿¡æ¯ä¸»é¡µ
- å…¶ä»–: åŒ…æ‹¬è·¯ç”±é…ç½®ç­‰



## åç«¯è¯¦ç»†è¯´æ˜

### æ•°æ®åº“

#### è¿æ¥æ•°æ®åº“

è¿æ¥æ•°æ®åº“åªéœ€è¦ä½¿ç”¨`mgo.Dial`è¿›è¡Œè¿æ¥ç„¶åè®¾ç½®è¿æ¥æ¨¡å¼å³å¯

```go
func DBservice() (*mgo.Session, error) {
	session, err := mgo.Dial("mongodb://47.103.210.109:27017")
	if err != nil {
		fmt.Println(err)
		return nil, err
	}
	session.SetMode(mgo.Monotonic, true)

	return session, nil
}
```

#### è®¾ç½®çš„æ•°æ®åº“

æœ¬é¡¹ç›®ä¸­å…±ä½¿ç”¨äº†å››ä¸ªæ•°æ®åº“

- ç”¨æˆ·æ•°æ®åº“

```go
type User struct {
	ID           bson.ObjectId `bson:"_id"`          // ç”¨æˆ·ID
	Pwd          string        `bson:"password"`     //ç”¨æˆ·å¯†ç 
	Email        string        `bson:"email"`        // ç”¨æˆ·å”¯ä¸€é‚®ç®±
	Info         UserInfo      `bson:"info"`         // ç”¨æˆ·ä¸ªæ€§ä¿¡æ¯
	LikeCount    int64         `bson:"likeCount"`    // è¢«ç‚¹èµæ•°
	ContentCount int64         `bson:"contentCount"` // å†…å®¹æ•°é‡
}
```

- æ–‡ç« æ•°æ®åº“

```go
type Content struct {
	ID          bson.ObjectId `bson:"_id"`
	Detail      string        `bson:"detail"`      // è¯¦æƒ…ä»‹ç»
	OwnID       bson.ObjectId `bson:"ownId"`       // ä½œè€…ID [ç´¢å¼•]
	PublishDate int64         `bson:"publishDate"` // å‘å¸ƒæ—¥æœŸ
	LikeNum     int64         `bson:"likeNum"`     // ç‚¹èµæ•°
	Public      bool          `bson:"public"`      // æ˜¯å¦å…¬å¼€
	Tag         []string      `bson:"tag"`         // æ ‡ç­¾
}
```

- ç‚¹èµæ•°æ®åº“

```go
type Like struct {
	ID        bson.ObjectId `bson:"_id"`
	UserID    bson.ObjectId `bson:"userId"`    // ç”¨æˆ·ID
	ContentID bson.ObjectId `bson:"contentId"` // å†…å®¹ID
}
```

- é€šçŸ¥æ•°æ®åº“

```go
type NotificationDetail struct {
	ID         bson.ObjectId `bson:"_id"`
	CreateTime int64         `bson:"time"`
	Content    string        `bson:"content"`   // é€šçŸ¥å†…å®¹
	SourceID   bson.ObjectId `bson:"sourceId"`  // æºID ï¼ˆç‚¹èµç”¨æˆ·ï¼‰
	TargetID   bson.ObjectId `bson:"targetId"`  // ç›®æ ‡ID ï¼ˆè¢«ç‚¹èµç”¨æˆ·ï¼‰
	ContentID  bson.ObjectId `bson:"contentId"` //ç‚¹èµæ–‡ç« ID
	Type       string        `bson:"type"`      // ç±»å‹ï¼šæš‚æ—¶åªæœ‰like
}
```



### æ•°æ®åº“æ“ä½œ

- å¢åŠ æ•°æ®ï¼š`m.DB.Insert`
- ä¿®æ”¹æ•°æ®ï¼š`m.DB.UpdateId`
- åˆ é™¤æ•°æ®ï¼š`m.DB.RemoveId`
- æŸ¥æ‰¾æ•°æ®
  - é€šè¿‡IDï¼š`m.DB.FindId`
  - é€šè¿‡é€‰æ‹©å™¨ï¼š`m.DB.Find`

### æ§åˆ¶å™¨
>controllerä¸­å®ç°å¯¹åç«¯æ¥å—åˆ°ä¸åŒMethodå’ŒPathè¯·æ±‚çš„å¤„ç†ï¼Œä¸»è¦æ“ä½œåŒ…æ‹¬sessionéªŒè¯ã€Tokenç­¾å‘å’ŒéªŒè¯ã€ç”¨æˆ·ä¿¡æ¯åˆ¤æ–­ã€è®¾ç½®è¯·æ±‚çš„è¿”å›ä¿¡æ¯ç­‰ã€‚åˆ†ä¸ºUserã€Contentã€Likeã€Notificationå››ä¸ªæ¨¡å—
>

#### User
>Userä¸­å®ç°å¯¹äºç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€æ›´æ”¹ç”¨æˆ·åã€è·å–ä¸ªäººä¿¡æ¯ç­‰è¯·æ±‚çš„å¤„ç†ï¼ŒåŒæ—¶å¢åŠ å¯¹äºOPTIONSåŸŸéªŒè¯è¯·æ±‚çš„æ”¯æŒ

ä¸»è¦è¯·æ±‚å¤„ç†è¿‡ç¨‹å¦‚ä¸‹ï¼š
- ç”¨æˆ·æ³¨å†Œ 
  - ç”¨æˆ·æ³¨å†Œçš„è·¨åŸŸéªŒè¯ OPTIONS /user/register
    - è¿”å›è¯·æ±‚æˆåŠŸçš„200ä¿¡æ¯ç 
  - ç”¨æˆ·æ³¨å†Œ POST /user/register 
    - è¯»å–Requestä¸­çš„Bodyçš„jsonå‚æ•°
    - ä½¿ç”¨ç”¨æˆ·è¯·æ±‚ä¿¡æ¯è°ƒç”¨modelä¸­çš„æ–¹æ³•è¿›è¡Œç”¨æˆ·æ³¨å†Œ
    - æ ¹æ®æ³¨å†ŒæˆåŠŸä¸å¦è¿”å›successç­‰ä¿¡æ¯


```go
// RegisterReq POST /user/register æ³¨å†Œè¯·æ±‚
type RegisterReq struct {
	Name     string `json:"username"`
	Email    string `json:"email"`
	Password string `json:"password"`
}

//OptionsRegister OPTIONS /user/register ç”¨æˆ·æ³¨å†Œ
func (c *UsersController) OptionsRegister() {
	return
}

//PostRegister POST /user/register ç”¨æˆ·æ³¨å†Œ
func (c *UsersController) PostRegister() (res models.CommonRes) {
	req := RegisterReq{}
	if err := c.Ctx.ReadJSON(&req); err != nil {
		res.State = models.StatusBadReq
	}
	if err := c.Model.Register(req.Name, req.Password, req.Email); err != nil {
		res.State = err.Error()
	} else {
		//c.Session.Set("name", req.Name)
		res.State = models.StatusSuccess
	}
	return
}
```


- ç”¨æˆ·ç™»å½•
  - ç”¨æˆ·ç™»é™†çš„è·¨åŸŸéªŒè¯ Options /user/login 
    - è¿”å›è¯·æ±‚æˆåŠŸçš„200ä¿¡æ¯ç 
  - ç™»é™†è¯·æ±‚ POST /user/login 
    - è¯»å–Requestä¸­bodyçš„jsonå‚æ•°
    - æ ¹æ®ç”¨æˆ·è¯·æ±‚ä¸­çš„ç”¨æˆ·åå’Œå¯†ç ä¿¡æ¯è°ƒç”¨modelä¸­çš„Loginæ£€æŸ¥æ˜¯å¦å­˜åœ¨
    - ç­¾å‘Tokenå’Œè®¾ç½®Sessionçš„ç”¨æˆ·IDä¿¡æ¯
    - æ ¹æ®ç™»é™†æˆåŠŸä¸å¦è¿”å›çŠ¶æ€ä¿¡æ¯åŠToken

>**Tokenç­¾å‘**ï¼š
>ç”¨æˆ·çš„Tokenåœ¨ç™»å½•æ—¶ç­¾å‘ï¼Œç”¨äºä¹‹åè·å–éƒ¨åˆ†APIä¿¡æ¯æ—¶çš„èº«ä»½éªŒè¯ã€ç”±å®¢æˆ·ç«¯Cookieå­˜å‚¨ï¼ŒTokenåœ¨ç­¾å‘æ—¶è®¾ç½®äº†å…¶ä¸­å¯¹åº”çš„ç”¨æˆ·ä¿¡æ¯ä»¥åŠæœ‰æ•ˆæ—¶é•¿ï¼Œè¿”å›å€¼ä¸ºåŠ å¯†æ ¼å¼ï¼Œç”±æœåŠ¡ç«¯æ¥å—å¹¶ä½¿ç”¨æœåŠ¡ç«¯ç§é’¥è§£å¯†å’ŒéªŒè¯Tokenä¿¡æ¯

```go
// LoginReq POST /user/login ç™»é™†è¯·æ±‚
type LoginReq struct {
	Name     string `json:"username"`
	Password string `json:"password"`
}

//OptionsLogin Options /user/login ç”¨æˆ·ç™»é™†
func (c *UsersController) OptionsLogin() {
	return
}

//PostLogin POST /user/login ç”¨æˆ·ç™»é™†
func (c *UsersController) PostLogin() (res models.CommonRes) {
	req := LoginReq{}
	err := c.Ctx.ReadJSON(&req)
	if err != nil || req.Name == "" || req.Password == "" {
		res.State = models.StatusBadReq
		return
	}
	userID, err := c.Model.Login(req.Name, req.Password)
	if err != nil {
		res.State = err.Error()
	} else {
		token := jwt.NewWithClaims(jwt.SigningMethodHS256, jwt.MapClaims{
			"name":     req.Name,
			"password": req.Password,
			"exp":      time.Now().Add(time.Hour * 1).Unix(),
		})
		// è¿™é‡Œçš„å¯†é’¥å’Œå‰é¢çš„å¿…é¡»ä¸€æ ·
		tokenString, _ := token.SignedString([]byte("My Secret"))
		res.Data = tokenString
		c.Session.Set("myid", userID)
		fmt.Println(c.Session)
		res.State = models.StatusSuccess
	}
	return
}
```

- ç”¨æˆ·ç™»å‡ºï¼š
  - é€€å‡ºç™»é™† POST /user/logout 
    - æ ¹æ®Sessionæ£€æŸ¥ç”¨æˆ·æ˜¯å¦å¤„äºç™»å½•çŠ¶æ€
    - åˆ é™¤å¯¹åº”çš„Sessionä¿¡æ¯
    - æ ¹æ®ç™»å‡ºæ“ä½œçš„æˆåŠŸä¸å¦å›æ‰§

```go
//PostLogout POST /user/logout é€€å‡ºç™»é™†
func (c *UsersController) PostLogout() (res models.CommonRes) {
	fmt.Println(c.Session)
	if c.Session.Get("myid") == nil {
		res.State = models.StatusNotLogin
		return
	}
	c.Session.Delete("myid")
	res.State = models.StatusSuccess
	return
}
```

- æ›´æ–°ç”¨æˆ·å
	- æ›´æ–°ç”¨æˆ·åçš„è·¨åŸŸè¯·æ±‚ OPTIONS /user/name
		- è¿”å›æˆåŠŸçš„200ä¿¡å·ç 
	- æ›´æ–°ç”¨æˆ·å POST /user/name  (Token required)
		- é¦–å…ˆæ£€æŸ¥ç”¨æˆ·çš„Sessionçš„idé¡¹æ˜¯å¦ä¸ºç©ºæ¥åˆ¤æ–­ç”¨æˆ·çš„ç™»é™†çŠ¶æ€
		- ä¹‹åè·å–Requestçš„Headeréƒ¨åˆ†çš„Tokenä¿¡æ¯ï¼Œè§£ç å¹¶æŸ¥çœ‹ä¿¡æ¯æ˜¯å¦æœ‰æ•ˆ
		- éªŒè¯é€šè¿‡åè°ƒç”¨modelå‡½æ•°æ›´æ–°ç”¨æˆ·å
		- æ ¹æ®æ‰§è¡ŒæˆåŠŸæƒ…å†µè¿”å›çŠ¶æ€

```go
//NameReq POST /user/name æ›´æ–°ç”¨æˆ·å
type NameReq struct {
	Name string `json:"name"`
}

//OptionsName OPTIONS /user/name
func (c *UsersController) OptionsName() {
	return
}

//PostName POST /user/name æ›´æ–°ç”¨æˆ·å (Token required)
func (c *UsersController) PostName() (res models.CommonRes) {
	if c.Session.Get("id") == nil {
		res.State = models.StatusNotLogin
		return
	}
	token, err := request.ParseFromRequest(c.Ctx.Request(), request.AuthorizationHeaderExtractor,
		func(token *jwt.Token) (i interface{}, e error) {
			return []byte("My Secret"), nil
		})

	if err != nil || !token.Valid {
		res.Data = err.Error()
		res.State = models.StatusBadReq
		return
	}
	req := NameReq{}
	err := c.Ctx.ReadJSON(&req)
	if err != nil || req.Name == "" {
		res.State = models.StatusBadReq
		return
	}
	err = c.Model.SetUserName(c.Session.GetString("id"), req.Name)
	if err != nil {
		res.State = err.Error()
	} else {
		res.State = models.StatusSuccess
	}
	return
}
```

- è·å–ç”¨æˆ·ä¿¡æ¯
	 - è·å–ç”¨æˆ·ä¿¡æ¯ GET /user/info/{userID:string}
	 	- é¦–å…ˆæ ¹æ®å‚æ•°selfè¿›è¡Œè½¬æ¢
		- éªŒè¯sessionæ¥åˆ¤æ–­ç™»é™†çŠ¶æ€
		- è°ƒç”¨modelå‡½æ•°æ¥ä»æ•°æ®åº“è·å–å¯¹åº”ä¿¡æ¯
		- å°†è·å¾—ä¿¡æ¯å›æ‰§ç»™è¯·æ±‚è€…

```go
//GetInfo GET /user/info/{userID:string}
func (c *UsersController) GetInfoBy(id string) (res models.UserInfoRes) {
	if id == "self" {
		if c.Session.Get("id") == nil {
			res.State = models.StatusNotLogin
			return
		}
		id = c.Session.GetString("id")
	} else if !bson.IsObjectIdHex(id) {
		res.State = models.StatusBadReq
		return
	}
	userinfores, err := c.Model.GetUserInfo(id)
	res = userinfores
	if err != nil {
		res.State = err.Error()
	} else {
		res.State = models.StatusSuccess
	}
	return
}
```

#### Content

>Contentä¸­åŒ…å«ç”¨æˆ·å‘é€çš„åšå®¢å†…å®¹ä¿¡æ¯çš„è¯·æ±‚å¤„ç†ï¼Œä¸»è¦æ¶‰åŠäº†å†…å®¹çš„åˆ†é¡µæ˜¾ç¤ºã€Sessionçš„éªŒè¯ã€TokenéªŒè¯ã€è·¨åŸŸOPTIONSè¯·æ±‚å¤„ç†ç­‰
>

- æµè§ˆå™¨è·¨åŸŸOPTIONSè¯·æ±‚
	- ä½¿ç”¨ç»Ÿä¸€çš„Optionså‡½æ•°å¤„ç†
	- ä½¿ç”¨ç»Ÿä¸€çš„OptionsByå‡½æ•°å¤„ç†

>ç”±äºContentä¸‹çš„è¯·æ±‚çš„Pathå‡ä¸º/api/content/*æˆ–/api/content/{*}ï¼Œæ‰€ä»¥åªéœ€è¦å®ç°ä¸¤ä¸ªå¯¹åº”çš„Optionsè¯·æ±‚ï¼Œå³å¯è§£å†³æ‰€æœ‰è¯·æ±‚çš„è·¨åŸŸOPTIONSåŸŸè¯·æ±‚

```go
//Options options
func (c *ContentController) Options() {
	return
}

//OptionsBy options
func (c *ContentController) OptionsBy(contentID string) {
	return
}
```

- è·å–æŒ‡å®šå†…å®¹
	- è·å–æŒ‡å®šå†…å®¹ -GET /api/content/detail/{contentID:string} 
		- æ ¹æ®ç”¨æˆ·çš„Sessionæ¥åˆ¤æ–­ç™»å½•çŠ¶æ€
		- è°ƒç”¨modelçš„å‡½æ•°æ¥ä»æ•°æ®åº“ä¸­è·å–å¯¹åº”å†…å®¹ä¿¡æ¯
		- è¿”å›ä¿¡æ¯ä»¥åŠè¯·æ±‚çŠ¶æ€


```go
//GetDetailBy GET /api/content/detail/{contentID:string} è·å–æŒ‡å®šå†…å®¹
func (c *ContentController) GetDetailBy(contentID string) (res models.ContentDetailres) {
	if c.Session.Get("id") == nil {
		res.State = models.StatusNotLogin
	}
	if contentID == "" {
		res.State = models.StatusBadReq
		return
	}
	contentdetailres, err := c.Model.GetDetailByID(contentID)
	res = contentdetailres
	if err != nil {
		res.State = err.Error()
	} else {
		res.State = models.StatusSuccess
	}
	return
}
```

- åˆ é™¤æŒ‡å®šå†…å®¹
	- åˆ é™¤æŒ‡å®šå†…å®¹ DELETE /api/content/{contentID:string} 
		- é¦–å…ˆåˆ¤æ–­Sessionæ¥è·å–ç™»å½•çŠ¶æ€
		- ä¹‹ååˆ¤æ–­åˆ é™¤å†…å®¹çš„IDæ˜¯å¦åˆæ³•
		- è·å–Requestä¸­Headerçš„Tokenï¼Œå¹¶è§£ç åˆ¤æ–­æ˜¯å¦è¿‡æœŸ
		- è°ƒç”¨modelçš„å‡½æ•°ä»æ•°æ®åº“ä¸­åˆ é™¤å¯¹åº”ä¿¡æ¯
		- è¿”å›æ‰§è¡Œæƒ…å†µsuccessç­‰ 

```go
//DeleteBy DELETE /api/content/{contentID:string}  åˆ é™¤æŒ‡å®šå†…å®¹
func (c *ContentController) DeleteBy(contentID string) (res models.CommonRes) {
	if c.Session.Get("id") == nil {
		res.State = models.StatusNotLogin
	}
	if contentID == "" {
		res.State = models.StatusBadReq
		return
	}
	token, err := request.ParseFromRequest(c.Ctx.Request(), request.AuthorizationHeaderExtractor,
		func(token *jwt.Token) (i interface{}, e error) {
			return []byte("My Secret"), nil
		})

	if err != nil || !token.Valid {
		res.Data = err.Error()
		res.State = models.StatusBadReq
		return
	}
	err = c.Model.RemoveContent(contentID)
	if err != nil {
		res.State = err.Error()
	} else {
		res.State = models.StatusSuccess
	}
	return
}
```

- è·å–å…¬å…±å†…å®¹
	- è·å–å…¬å…±å†…å®¹ GET /api/content/public
		- æ ¹æ®sessionè·å–ç™»å½•æƒ…å†µ
		- è·å–Requestçš„bodyå‚æ•°æ¥è¯»å–åˆ†é¡µä¿¡æ¯
		- æ ¹æ®åˆ†é¡µä¿¡æ¯æ¥ä»æ•°æ®åº“ç­›é€‰æ•°æ®
		- è¿”å›å…¬å…±å†…å®¹å’ŒçŠ¶æ€ä¿¡æ¯  

```go
type PageParams struct {
	Page    int `url:"page"`
	PerPage int `url:"per_page"`
}

//GetPublic GET /api/content/public  è·å–å…¬å…±å†…å®¹
func (c *ContentController) GetPublic() (res models.ContentPublicList) {
	if c.Session.Get("id") == nil {
		res.State = models.StatusNotLogin
	}
	params := PageParams{}
	err := c.Ctx.ReadQuery(&params)
	if err != nil && !iris.IsErrPath(err) {
		res.State = models.StatusBadReq
		return
	}
	if params.Page < 1 || params.PerPage < 1 {
		res.State = models.StatusBadReq
		return
	}
	contentpublicres, err := c.Model.GetPublic(params.Page, params.PerPage)
	res = contentpublicres
	if err != nil {
		res.State = err.Error()
	} else {
		res.State = models.StatusSuccess
	}
	return
}

```

- è·å–ç”¨æˆ·çš„å…¨éƒ¨å‘å¸ƒå†…å®¹
	- è·å–æŒ‡å®šç”¨æˆ·çš„æ‰€æœ‰å†…å®¹ GET /api/content/usercontent/{userID:string} 
		- é¦–å…ˆè¯»å–è¯·æ±‚çš„å‚æ•°userIDå’Œbodyä¸­çš„åˆ†é¡µä¿¡æ¯
		- æ ¹æ®åˆ†é¡µä¿¡æ¯æ¥æŸ¥è¯¢æ•°æ®ï¼Œè°ƒç”¨modelçš„ReadQuery
		- æ ¹æ®userIDæ¥åˆ¤æ–­è¯»å–è‡ªèº«çš„å†…å®¹è¿˜æ˜¯ä»–äººå†…å®¹(å†³å®šäº†æ˜¯å¦è·å–privateæ¶ˆæ¯)
		- è¿”å›è·å¾—çš„æ•°æ®å’ŒçŠ¶æ€ä¿¡æ¯

> å®ç°äº†APIçš„åˆ†é¡µåŠŸèƒ½


```go 
//GetUsercontentBy GET /api/content/usercontent/{userID:string} è·å–æŒ‡å®šç”¨æˆ·çš„æ‰€æœ‰å†…å®¹
func (c *ContentController) GetUsercontentBy(userID string) (res models.ContentListByUser) {
	var contentlistbyuserres models.ContentListByUser
	var err error
	params := PageParams{}
	err = c.Ctx.ReadQuery(&params)
	if err != nil && !iris.IsErrPath(err) {
		res.State = models.StatusBadReq
		return
	}
	if params.Page < 1 || params.PerPage < 1 {
		res.State = models.StatusBadReq
		return
	}
	if userID == "" {
		res.State = models.StatusBadReq
		return
	} else if userID == "self" {
		if c.Session.Get("id") == nil {
			res.State = models.StatusNotLogin
			return
		}
		userID = c.Session.GetString("id")
		contentlistbyuserres, err = c.Model.GetContentSelf(userID, params.Page, params.PerPage)
	} else {
		contentlistbyuserres, err = c.Model.GetContentByUser(userID, params.Page, params.PerPage)
	}

	res = contentlistbyuserres
	if err != nil {
		res.State = err.Error()
	} else {
		res.State = models.StatusSuccess
	}
	return
}
```

- å‘å¸ƒæ–‡æœ¬Content
	- å¢åŠ æ–‡æœ¬å†…å®¹çš„è·¨åŸŸOPTIONSå¤„ç†  OPTIONS /api/content/text
		- è¿”å›æ­£ç¡®çš„å‘å¸ƒä¿¡æ¯å³å¯ 
	- å¢åŠ æ–‡æœ¬å†…å®¹  POST /api/content/text 
		- é¦–å…ˆæ ¹æ®sessionåˆ¤æ–­ç™»é™†çŠ¶æ€
		- è¿›è¡Œtokençš„è§£ç å’Œæ£€æŸ¥
		- è°ƒç”¨modelä¸­çš„å‡½æ•°å‘å¸ƒæ–°çš„Content
		- è¿”å›çŠ¶æ€ä¿¡æ¯

```go
//TextReq POST /api/content/text å¢åŠ æ–‡æœ¬å†…å®¹
type TextReq struct {
	Detail   string   `json:"detail"`
	Tags     []string `json:"tags"`
	IsPublic bool     `json:"isPublic"`
}

//OptionsText  OPTIONS /api/content/text å¢åŠ æ–‡æœ¬å†…å®¹
func (c *ContentController) OptionsText() {
	return
}

//PostText  POST /api/content/text å¢åŠ æ–‡æœ¬å†…å®¹
func (c *ContentController) PostText() (res models.CommonRes) {
	id := c.Session.Get("id")
	if id == nil {
		res.State = models.StatusNotLogin
		return
	}
	//token check
	token, err := request.ParseFromRequest(c.Ctx.Request(), request.AuthorizationHeaderExtractor,
		func(token *jwt.Token) (i interface{}, e error) {
			return []byte("My Secret"), nil
		})

	if err != nil || !token.Valid {
		res.Data = err.Error()
		res.State = models.StatusBadReq
		return
	}
	req := TextReq{}
	err := c.Ctx.ReadJSON(&req)
	if err != nil || req.Detail == "" {
		res.State = models.StatusBadReq
		return
	}
	err1 := c.Model.AddContent(req.Detail, req.Tags, id.(string), req.IsPublic)
	if err1 != nil {
		res.State = err1.Error()
	} else {
		res.State = models.StatusSuccess
	}
	return
}
```


- æ›´æ–°æ–‡æœ¬
	 - é¦–å…ˆè¿›è¡Œè·¨åŸŸçš„OPTIONSå¤„ç† OPTIONS /api/content/update
	  	- è¿”å›æ­£ç¡®çš„200ä¿¡æ¯ç 
	- æ›´æ–°æ–‡æœ¬å†…å®¹ POST /api/content/update
		- ä¸å‘å¸ƒæ–‡æœ¬çš„æ“ä½œåŸºæœ¬ç›¸åŒ
		- å‚æ•°å¢åŠ äº†ä¸€ä¸ªContentIDï¼Œå¹¶ä¸”åœ¨æŸ¥è¯¢æ“ä½œä¸­å¢åŠ äº†å¯¹äºContentçš„OwnIDçš„åˆ¤æ–­
		- è¿”å›æ­£ç¡®çš„çŠ¶æ€ä¿¡æ¯

```go
//TextUpdateReq æ–‡æœ¬å†…å®¹
type TextUpdateReq struct {
	ID       string   `json:"contentID"`
	Detail   string   `json:"detail"`
	Tags     []string `json:"tags"`
	IsPublic bool     `json:"isPublic"`
}

//OptionsUpdate OPTIONS /api/content/update æ›´æ–°æ–‡æœ¬å†…å®¹
func (c *ContentController) OptionsUpdate() {
	return
}

//PostUpdate  POST /api/content/update æ›´æ–°æ–‡æœ¬å†…å®¹
func (c *ContentController) PostUpdate() (res models.CommonRes) {
	id := c.Session.Get("id")
	if id == nil {
		res.State = models.StatusNotLogin
		return
	}
	//token check
	token, err := request.ParseFromRequest(c.Ctx.Request(), request.AuthorizationHeaderExtractor,
		func(token *jwt.Token) (i interface{}, e error) {
			return []byte("My Secret"), nil
		})

	if err != nil || !token.Valid {
		res.Data = err.Error()
		res.State = models.StatusBadReq
		return
	}
	req := TextUpdateReq{}
	err := c.Ctx.ReadJSON(&req)
	if err != nil || req.Detail == "" {
		res.State = models.StatusBadReq
		return
	}
	err1 := c.Model.UpdateContent(req.ID, req.Detail, req.Tags, id.(string), req.IsPublic)
	if err1 != nil {
		res.State = err1.Error()
	} else {
		res.State = models.StatusSuccess
	}
	return
}
```


#### like

>Like Controllerä¸»è¦å®ç°ç‚¹èµåŠŸèƒ½ï¼Œä»¥åŠä¸ªäººå–œçˆ±åˆ—è¡¨ï¼Œä½¿ç”¨äº†Sessionæ¥è¿›è¡Œç”¨æˆ·éªŒè¯

- è·å–ç”¨æˆ·çš„ç‚¹èµåˆ—è¡¨
	- éªŒè¯idæ˜¯å¦å­˜åœ¨
	- è°ƒç”¨modelä¸­çš„å‡½æ•°è·å–ä¸ªäººçš„ç‚¹èµä¿¡æ¯
	- è¿”å›ç‚¹èµä¿¡æ¯å’ŒçŠ¶æ€

```go
// GetBy Get /like/{contentID} è·å–ç”¨æˆ·ç‚¹èµåˆ—è¡¨
func (c *LikeController) GetBy(id string) (res LikeRes) {
	if !bson.IsObjectIdHex(id) {
		res.State = models.StatusBadReq
		return
	}
	var err error
	res.Data, err = c.Model.GetUserListByContentID(id)
	if err != nil {
		res.State = err.Error()
	}
	res.State = models.StatusSuccess
	return
}
```

- å¯¹å†…å®¹ç‚¹èµ
	- å¯¹æŸä¸ªå†…å®¹ç‚¹èµçš„OPTIONSåŸŸè¯·æ±‚ Options /like/{contentID}
		- è¿”å›æ­£ç¡®çš„200ä¿¡æ¯ç 
	- å¯¹å†…å®¹ç‚¹èµ  POST /like/{contentID}
		- æ ¹æ®Sessionæ¥åˆ¤æ–­ç™»å½•çŠ¶æ€ä»¥åŠIDçš„æœ‰æ•ˆæ€§
		- è°ƒç”¨modelçš„å‡½æ•°å¯¹å†…å®¹è¿›è¡Œç‚¹èµ
		- æ ¹æ®æ“ä½œçŠ¶æ€è¿”å›å›æ‰§

```go
//Options Options /like/{contentID} å¯¹æŸä¸ªå†…å®¹ç‚¹èµ
func (c *LikeController) OptionsBy(id string) {
	c.Ctx.StatusCode(http.StatusOK)
	fmt.Println("hahahah")
	return
}

//â€‹PostBy POST /like/{contentID} å¯¹æŸä¸ªå†…å®¹ç‚¹èµ
func (c *LikeController) PostBy(id string) (res models.CommonRes) {
	if c.Session.Get("id") == nil {
		res.State = models.StatusNotLogin
		return
	}
	if !bson.IsObjectIdHex(id) {
		res.State = models.StatusBadReq
		return
	}
	err := c.Model.LikeByID(id, c.Session.Get("id").(string))
	if err != nil {
		res.State = err.Error()
	}
	res.State = models.StatusSuccess
	return
}
```

- å–æ¶ˆç‚¹èµ
	- å–æ¶ˆç”¨æˆ·å¯¹æŸä¸ªå†…å®¹çš„ç‚¹èµ PATCH /like/{contentID} 
		- è·å–Sessionåˆ¤æ–­ç”¨æˆ·çš„ç™»å½•çŠ¶æ€
		- åˆ¤æ–­idçš„æœ‰æ•ˆæ€§
		- è°ƒç”¨modelçš„å‡½æ•°æ¥å–æ¶ˆç‚¹èµ
		- è¿”å›å‡½æ•°æ‰§è¡Œçš„çŠ¶æ€ä¿¡æ¯

```go
//â€‹ PatchBy PATCH /like/{contentID} å–æ¶ˆç”¨æˆ·å¯¹æŸä¸ªå†…å®¹çš„ç‚¹èµ
func (c *LikeController) PatchBy(id string) (res models.CommonRes) {
	if c.Session.Get("id") == nil {
		res.State = models.StatusNotLogin
		return
	}
	if !bson.IsObjectIdHex(id) {
		res.State = models.StatusBadReq
		return
	}
	err := c.Model.CancelLikeByID(id, c.Session.Get("id").(string))
	if err != nil {
		res.State = err.Error()
	}
	res.State = models.StatusSuccess
	return
}
```

#### Notification
> Notificationç”¨æˆ·è·å–ç”¨æˆ·çš„æ‰€æœ‰é€šçŸ¥ï¼Œä¹Ÿå°±æ˜¯åˆ«äººå¯¹ä½ çš„ç‚¹èµæƒ…å†µä»¥åŠåˆ é™¤é€šçŸ¥ï¼Œä½¿ç”¨Sessionæ¥è¿›è¡Œç”¨æˆ·åˆ¤æ–­ï¼Œå¹¶ä¸”åœ¨mainå‡½æ•°ä¸­ä½¿ç”¨jwtä¸­é—´ä»¶æ¥å¯¹å¯¹åº”çš„Notificationçš„Pathè¿›è¡ŒTokenéªŒè¯ï¼Œæ‰€ä»¥Controllerä¸­å°±ä¸éœ€è¦å†æ¬¡éªŒè¯

- è·å–ç”¨æˆ·æ‰€æœ‰é€šçŸ¥
	- è·å–ç”¨æˆ·æ‰€æœ‰é€šçŸ¥ GET /api/notification/all
		- æ ¹æ®Sessionæ¥åˆ¤æ–­ç”¨æˆ·çš„ä¸ªäººç™»å½•çŠ¶æ€å’Œä¸ªäººID
		- è°ƒç”¨modelä¸­çš„å‡½æ•°æ¥è·å–ä¸ªäººNotification
		- å°†Notificationå’ŒçŠ¶æ€ä¿¡æ¯è¿”å›

```go
//GetAll GET /api/notification/all  è·å–ç”¨æˆ·æ‰€æœ‰é€šçŸ¥
func (c *NotificationController) GetAll() (res models.UserNotificationres) {
	if c.Session.Get("id") == nil {
		res.State = models.StatusNotLogin
		return
	}
	id := c.Session.GetString("id")
	notificationres, err := c.Model.GetNotificationByUserID(id)
	res = notificationres
	if err != nil {
		res.State = err.Error()
	} else {
		res.State = models.StatusSuccess
	}
	return
}
```

- åˆ é™¤æŒ‡å®šé€šçŸ¥
	- åˆ é™¤é€šçŸ¥ DELETE /api/notificaiton/{NotificationID:string}
		- è·å–ç”¨æˆ·çš„sessionæ¥åˆ¤æ–­ç™»é™†çŠ¶æ€
		- åˆ¤æ–­notificationçš„idåˆæ³•æ€§
		- è°ƒç”¨modelçš„å‡½æ•°æ¥åˆ é™¤å¯¹åº”notification
		- è¿”å›å‡½æ•°æ‰§è¡ŒçŠ¶æ€

```go
//DeleteBy DELETE /api/notificaiton/{NotificationID:string}  åˆ é™¤æŒ‡å®šé€šçŸ¥
func (c *NotificationController) DeleteBy(notificationID string) (res models.CommonRes) {
	if c.Session.Get("id") == nil {
		res.State = models.StatusNotLogin
		return
	}
	if notificationID == "" {
		res.State = models.StatusBadReq
	}
	err := c.Model.DeleteNotificationByID(notificationID)
	if err != nil {
		res.State = err.Error()
	} else {
		res.State = models.StatusSuccess
	}
	return

}
```


### ä¸»å‡½æ•°

>mainå‡½æ•°ä¸­è¿›è¡Œäº†æ•´ä¸ªæ¡†æ¶çš„åˆå§‹åŒ–è®¾ç½®ä»¥åŠç›‘å¬å¯ç”¨ï¼Œè®¾è®¡äº†æ•°æ®åº“é…ç½®ï¼Œæ·»åŠ ä¸­é—´ä»¶ï¼Œè·¯ç”±è®¾ç½®å’ŒAPI Rootçš„å®ç°

- é¦–å…ˆè¿›è¡ŒSessionçš„åˆå§‹åŒ–ï¼ŒSessionæ˜¯æµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¿æŒä¼šè¯çŠ¶æ€çš„å…³è”ä¿¡æ¯ï¼Œæˆ‘ä»¬åœ¨æœ¬é¡¹ç›®ä¸­ä½¿ç”¨sessionè¿›è¡Œç”¨æˆ·éªŒè¯

åˆå§‹åŒ–sessionï¼š

```go
	sesson, err := service.DBservice()
	if err != nil {
		fmt.Println("error")
	}
```
- ä¹‹ååˆå§‹åŒ–æˆ‘ä»¬çš„æ•°æ®åº“ï¼Œç”¨äºæ¯ä¸€ä¸ªmodelå¯¹åº”çš„æ•°æ®å­˜å‚¨

æ•°æ®åº“çš„åˆå§‹åŒ–ï¼š

```go
	//åˆ›å»ºæ•°æ®åº“
	var user models.UserDB
	user.DB = sesson.DB("project").C("user")
	var like models.LikeDB
	like.DBU = sesson.DB("project").C("user")
	like.DBL = sesson.DB("project").C("like")
	like.DBC = sesson.DB("project").C("content")
	like.DBN = sesson.DB("project").C("notification")
	var content models.ContentDB
	content.DB = sesson.DB("project").C("content")
	content.DBuser = sesson.DB("project").C("user")
	var notification models.NotifiationDB
	notification.DBN = sesson.DB("project").C("notification")
	notification.DBU = sesson.DB("project").C("user")
```
- åˆå§‹åŒ–irisæœåŠ¡,å¯ç”¨iris

```go
	app := iris.New()
	app.Use(myMiddleware)
```

- å®ç°API Rootï¼Œå®Œæˆæ˜¾ç¤ºç®€å•APIæœåŠ¡åˆ—è¡¨åŠŸèƒ½

```go
	app.Handle("GET", "/api", func(ctx iris.Context) {
		ctx.JSON(models.RootRes{
			"http://47.103.210.109:8080/api/user/info/{userID}",
			"http://47.103.210.109:8080/api/user/login",
			"http://47.103.210.109:8080/api/user/register",
			"http://47.103.210.109:8080/api/user/logout",
			"http://47.103.210.109:8080/api/user/name",

			"http://47.103.210.109:8080/api/content/{contentID}",
			"http://47.103.210.109:8080/api/content/detail/{contentID}",
			"http://47.103.210.109:8080/api/content/public",
			"http://47.103.210.109:8080/api/content/texts/{userID}",
			"http://47.103.210.109:8080/api/content/update",

			"http://47.103.210.109:8080/api/like/{contentID}",

			"http://47.103.210.109:8080/api/notificaiton/{notificationID}",
			"http://47.103.210.109:8080/api/notification/all",
		})
	})

	app.Handle("DELETE", "/api", func(ctx iris.Context) {
		ctx.JSON(models.RootRes{
			"AAAAAAA",
			"http://47.103.210.109:8080/api/user/login",
			"http://47.103.210.109:8080/api/user/register",
			"http://47.103.210.109:8080/api/user/logout",
			"http://47.103.210.109:8080/api/user/name",

			"http://47.103.210.109:8080/api/content/{contentID}",
			"http://47.103.210.109:8080/api/content/detail/{contentID}",
			"http://47.103.210.109:8080/api/content/public",
			"http://47.103.210.109:8080/api/content/texts/{userID}",
			"http://47.103.210.109:8080/api/content/update",

			"http://47.103.210.109:8080/api/like/{contentID}",

			"http://47.103.210.109:8080/api/notificaiton/{notificationID}",
			"http://47.103.210.109:8080/api/notification/all",
		})
	})
```


- è¿›è¡ŒSessionçš„åˆ›å»ºå’Œä½¿ç”¨

```go
	sessionID := "mySession"
	//sessionçš„åˆ›å»º
	sess := sessions.New(sessions.Config{
		Cookie: sessionID,
	})
	app.Use(sess.Handler())
```

- åŠ å…¥corsä¸­é—´ä»¶æ¥å¤„ç†è·¨åŸŸè¯·æ±‚ï¼Œå…è®¸è·¨åŸŸè®¿é—®ï¼š

```go
crs := cors.New(cors.Options{
		AllowedOrigins:   []string{"*"}, //å…è®¸é€šè¿‡çš„ä¸»æœºåç§°
		AllowCredentials: true,
	})
```

- åŠ å…¥JWTä¸­é—´ä»¶æ¥å¤„ç†TokenéªŒè¯ï¼š

```go
// JWTéªŒè¯ä¸­é—´ä»¶
func ValidateJwtMiddleware(ctx iris.Context) {
	token, err := request.ParseFromRequest(ctx.Request(), request.AuthorizationHeaderExtractor,
		func(token *jwt.Token) (i interface{}, e error) {
			return []byte("My Secret"), nil
		})

	if err != nil || !token.Valid {
		var errres models.CommonRes
		errres.State = models.StatusBadReq
		errres.Data = err.Error()
		ctx.JSON(errres)
	} else {
		ctx.Next()
	}
}
```

- ä½¿ç”¨myMiddlewareä¸­é—´ä»¶æ¥è®¾ç½®å…è®¸è·¨åŸŸå’Œå…è®¸çš„è¯·æ±‚æ–¹æ³•ï¼š

```go
func myMiddleware(ctx iris.Context) {
	ctx.Application().Logger().Infof("Runs before %s", ctx.Path())
	fmt.Println("test for middle")
	//ctx.Recorder().ResetHeaders()
	//ctx.Header("Access-Control-Allow-Origin", "*")
	//ctx.Header("Access-Control-Allow-Headers", "content-type")
	ctx.Header("Access-Control-Allow-Credentials","true");
	ctx.Header("Access-Control-Allow-Origin", "*")
	fmt.Println("Method", ctx.Request().Method)
	if ctx.Request().Method == "OPTIONS" {
		fmt.Println("test for core")
		ctx.StatusCode(200)	
		ctx.Header("Access-Control-Allow-Methods", "GET,POST,PUT,DELETE,PATCH,OPTIONS")
		ctx.Header("Access-Control-Allow-Headers", "Content-Type, Accept, Authorization")
		return
	}
	if ctx.Request().Method != "GET" && ctx.Request().Method != "POST"  {
		
	}
	ctx.Next()
}
```

- å®ç°user controllerçš„è·¯ç”±PATHå’ŒSessionè®¾ç½®ã€å¯ç”¨corsä¸­é—´ä»¶ï¼š

```go
	users := mvc.New(app.Party("/api/user", crs).AllowMethods())
	users.Register(sess.Start)
	users.Handle(&controllers.UsersController{Model: user})
```

- å®ç°like controllerçš„è·¯ç”±PATHå’ŒSessionè®¾ç½®ã€å¯ç”¨corsä¸­é—´ä»¶ï¼š

```go
	likes := mvc.New(app.Party("/api/like"))
	likes.Register(sess.Start)
	likes.Handle(&controllers.LikeController{Model: like})
```

- å®ç°contents controllerçš„è·¯ç”±PATHå’ŒSessionè®¾ç½®ã€å¯ç”¨corsä¸­é—´ä»¶ï¼š

```go
	contents := mvc.New(app.Party("/api/content"))
	contents.Register(sess.Start)
	contents.Handle(&controllers.ContentController{Model: content})
```

- å®ç°notification controllerçš„è·¯ç”±PATHå’ŒSessionè®¾ç½®ã€å¯ç”¨corsä¸­é—´ä»¶ï¼š

```go
	notifications := mvc.New(app.Party("/api/notification", crs).AllowMethods())
	notifications.Register(sess.Start)
	notifications.Handle(&controllers.NotificationController{Model: notification})
```

- æœ€åè®¾ç½®ç›‘å¬ç«¯å£ï¼Œå¼€å¯æœåŠ¡ï¼š

```go
app.Listen("0.0.0.0:8080")
```






## å±•ç¤ºè¿æ¥

[ğŸ”—](http://47.103.210.109:4200)

## å‚è€ƒæ–‡çŒ®

1. Github v3 APIæ–‡æ¡£ https://docs.github.com/cn/free-pro-team@latest/rest/reference/reactions
2. Iris æ¡†æ¶ä¸­æ–‡æ–‡æ¡£ https://learnku.com/docs/iris-go/10



